---
title: 'Final Project: Child Welfare in the US'
runtime: shiny
output:
  flexdashboard::flex_dashboard:
  orientation: columns
  vertical_layout: fill
resource_files:
- FinalDataforSubmission.csv

---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(dplyr)
library(DataExplorer)
library(ggplot2)
library(plotly)
library(shiny)
library(devtools)
library(waffle)
library(rsconnect)

# read in data 
childhealthdata <- read_csv("FinalDataforSubmission.csv")

#("C:/Users/rebec/Documents/GitHub/FinalProject_A/2019-2020 National Survey of Children's Health (NSCH)/FinalDataforSubmission.csv")

#adding filtered variables 
NewJersey <- childhealthdata %>%
  filter(State.FIPS.Code == "34")

Poor <- childhealthdata %>%
  filter(povlevel == "Less than 200% FPL")

MissedNeededCare <- childhealthdata %>%
  filter(ForegoneCare == "Yes")

parentEmoSup <- childhealthdata %>%
  filter(SomeoneEmoSup == 1)

yesbehaviorprobsALL <- childhealthdata %>%
  filter(behavior_1920 == "Yes")

White <- childhealthdata %>%
  filter(RaceCat == "White")

Black <- childhealthdata %>%
  filter(RaceCat == "Black")

Asian <- childhealthdata %>%
  filter(RaceCat == "Asian")

Hispanic <- childhealthdata %>%
  filter(RaceCat == "Hispanic")

OtherRace <- childhealthdata %>%
  filter(RaceCat == "Other")

uninsured <- childhealthdata %>%
  filter(InsGap_1920 == "Periods Uninsured")

childhealthdata <- childhealthdata %>% mutate(AceCount = recode_factor(ACEct_1920,
  "0" = "0",
  "1" = "1",
  "2" = "2",
  "3" = "3",
  "4" = "4",
  "5" = "5",
  "6" = "6", 
  "7" = "7",
  "8" = "8",
  "9" = "9",
  "10" = "10",
  "99" = "Missing",
  .ordered = TRUE,
  .default = "Unknown"))

```

Demographics
===================================== 
About this Project {.sidebar}
--------------------------------------------------------------
This project was created for submission as a part of Rutgers Data Visualization course. It focuses on child wellbeing in the United States, as evidenced by the National Survey of Children's Health, 2019-2020. 

This dashboard displays demographics of children surveyed, as trends related to insurance status, receiving care, povery, and Adverse Childhood Experiences (ACE).  

Created by [Rebecca Connelly]

Column
-------------------------------------------------------------

### Race of Child

```{r race}
#race 

RaceCount <- childhealthdata %>% 
  group_by(RaceCat) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

RaceWaffle <- c("Black" = 6.86, "Asian" = 39.20, "White" = 52.68, "Hispanic" = 559, "Other" = 5.04)

RaceWafflePlot <- waffle(RaceWaffle, rows = 25,
       legend_pos = "bottom")

RaceWafflePlot

```


### Racial Breakdown
```{r}
RaceCount %>% knitr::kable()
```

Column
-------------------------------------------------------------

### Age of Child 

```{r child age}

childhealthdata <- childhealthdata %>% rename(Age = Child.Age)

ageplot <- ggplot(childhealthdata) +
  aes(x = Age) +
  geom_histogram(bins = 35L, fill = "#1C7D1C") +
  labs(
    x = "Age of Child",
    y = "Number of Children",
    title = "Ages of Children",
    subtitle = "Age Distribution of Child of Interest, with an over sampling of 
children with disabilities and children ages 0-5",
    caption = "Data Source: National Survey of Children's Health, 2019-2020"
  ) +
  coord_flip() +
    theme_minimal()

ggplotly(ageplot) %>%
layout(title = list(text = paste0('Ages of Children',
                                    '<br>',
                                    '<sup>',
                                    'Age distribution of children sampled, with an over sampling of children with disabilities and children ages 0-5',
                                    '</sup>')),
  annotations = 
 list(x = 1, y = -0.1, text = "Data Source: National Survey of Children's Health, 2019-2020", 
      showarrow = F, xref='paper', yref='paper', 
      xanchor='right', yanchor='auto', xshift=0, yshift=0,
      font=list(size=10, color="black")))

#^source for caption in plotly code = https://stackoverflow.com/questions/45103559/plotly-adding-a-source-or-caption-to-a-chart
#soure code for title in plotly - https://datascott.com/blog/subtitles-with-ggplotly/

```

Overview {data-navmenu=Access}
=====================================



Column
-------------------------------------------------------------

### Insurance Coverage
```{r}

InsStatus <- childhealthdata %>% 
  group_by(InsGap_1920) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

InsStatus$percentage <- InsStatus$children/sum(InsStatus$children)*100
InsStatus$Round_off <- round(InsStatus$percentage) 

InsPieChart <- InsStatus %>%
  filter(!(InsGap_1920 %in% "Unknown")) %>%
  ggplot() +
  aes(x = "", y = children, fill = InsGap_1920) +
  geom_col(color = "black") +
  geom_label(aes(label = paste0(Round_off, "%")),
               color = "black",
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") + 
  guides(fill = guide_legend(title = "Insurance Coverage Status")) +
 scale_fill_brewer() +
  theme_void() 

InsPieChart

```

Column
-------------------------------------------------------------

### Needed Care by Insurance

```{r care insurance}
#insured status by received care
CareInsChart <- childhealthdata %>%
 filter(!(InsGap_1920 %in% "Unknown")) %>%
 filter(!(ForegoneCare %in% "Unknown")) %>%
 ggplot() +
 aes(x = ForegoneCare, fill = InsGap_1920) +
 geom_bar(position = "fill") +
 scale_fill_viridis_d(option = "viridis", direction = 1) +
 labs(x = "Whether Child Missed out on Needed Care", 
 y = "Proportion of Children", title = "Children Receiving Necessary Care by Insurance Status", caption = "Based on National Survey of Children's Health, 2019-2020", 
 fill = "Insured Status") +
 theme_minimal()

ggplotly(CareInsChart)
```

By Race {data-navmenu=Access}
=====================================
Column
-------------------------------------------------------------
### Insurance Coverage by Race
```{r}
#tbd insurance by race 
```

By Poverty Level {data-navmenu=Access}
=====================================

Column
-------------------------------------------------------------

### Needed Care by Poverty Level 

```{r care poverty}
CarePovChart <- childhealthdata %>%
 filter(!(ForegoneCare %in% "Unknown")) %>%
 ggplot() +
 aes(x = ForegoneCare, fill = povlevel) +
 geom_bar(position = "fill") +
 scale_fill_viridis_d(option = "cividis", 
 direction = 1) +
 labs(x = "Missed Out on Needed Care", y = "Proportion of Children", title = "Children Who Did Not Receive Needed Care by Poverty Level", 
 caption = "Based on National Survey of Children's Health, 2019-2020", fill = "Poverty Level") +
 theme_minimal()

ggplotly(CarePovChart)
```

Outcomes and Wellbeing
=====================================

Column {data-width=650}
-------------------------------------------------------------

### ACEs by Racial Category
```{r ACEs and Race}
ACEandRACE <- childhealthdata %>%
  filter(!(RaceCat %in% "Unknown")) %>%
  filter(!(AceCount %in% "Missing")) %>%
 ggplot() +
 aes(x = RaceCat, fill = AceCount) +
 geom_bar(position = "fill") +
  coord_flip() +
 scale_fill_viridis_d(option = "viridis", 
 direction = 1) +
 labs(x = "Race", y = "Proportion of Children", title = "Adverse Childhood Experiences (ACE) by Race in the US", 
 caption = "Based on National Survey of Children's Health, 2019-2020", fill = "Number of ACEs") +
 theme_minimal()

ggplotly(ACEandRACE)
```

Column
-------------------------------------------------------------
### ACEs and Flourishing Status
```{r ACE and Flourish}


FlrshAcePlot <- childhealthdata %>% 
  filter(!(FlourishStatus6to17 %in% "Unknown")) %>%
  filter(!(FlourishStatus6to17 %in% "NA, Under 5")) %>%
  filter(!(AceCount %in% "Missing")) %>%
  filter(!(AceCount %in% "Unknown")) %>%
ggplot() +
 aes(x = FlourishStatus6to17, fill = AceCount) +
 geom_bar(position = "fill") +
  coord_flip() +
  scale_fill_viridis_d(option = "viridis", 
 direction = 1) +
 labs(x = "Flourishing Items Met", y = "Proportion of Children", title = "Flourishing Status & Adverse Childhood Experiences (ACE)",
 subtitle = "Count of Children in the US Meeting Flourishing Criteria by Number of Adverse Childhood Experiences", 
 caption = "Based on National Survey of Children's Health, 2019-2020", fill = "Number of ACEs") +
 theme_minimal()

ggplotly(FlrshAcePlot)
```

