---
title: "FinalDraft1"
output: pdf_document
author: Rebecca Connelly
---

```{r setup, }
library(tidyverse)
library(DataExplorer)
library(esquisse)
```

## R Markdown



```{r read in data}
childhealthdata <- read_csv("C:/Users/rebec/Documents/GitHub/FinalProject_A/2019-2020 National Survey of Children's Health (NSCH)/ChildHealthData_Edited_1920_ONLY.csv")


introduce(childhealthdata)
#fixing column names 

names(childhealthdata) <- make.names(names(childhealthdata), unique=TRUE)

```

```{r editing variables}

#race 

childhealthdata$Race = as.factor(childhealthdata$Race) # converting to categorical

childhealthdata <- childhealthdata %>% mutate(RaceCat = recode(Race, 
  "1" = "Hispanic",
  "2" = "White",
  "3" = "Black",
  "4" = "Asian",
  "5" = "Other",
  "99" = "Unknown",
  .default = "Unknown"))

#health status

childhealthdata$ChildHealthStatus_1920 = as.factor(childhealthdata$ChildHealthStatus_1920) # converting to categorical

childhealthdata <- childhealthdata %>% mutate(ChildHealthStatus = recode(ChildHealthStatus_1920, 
  "1" = "Excellent or Very Good",
  "2" = "Good",
  "3" = "Fair or Poor",
  "99" = "Unknown",
  .default = "Unknown"))

#sex

childhealthdata$Sex1920 = as.factor(childhealthdata$Sex1920) # converting to categorical

childhealthdata <- childhealthdata %>% mutate(Sex = recode(Sex1920, 
  "1" = "Male",
  "2" = "Female",
  "99" = "Missing",
  .default = "Missing"))

#states

childhealthdata$State.FIPS.Code = as.factor(childhealthdata$State.FIPS.Code) # converting to categorical

childhealthdata <- childhealthdata %>% mutate(State = recode(State.FIPS.Code, 
  "1" = "AL",
"2" = "AK",
"4" = "AZ",
"5" = "AR",
"6" = "CA",
"8" = "CO",
"9" = "CT",
"10" = "DE",
"12" = "FL",
"13" = "GA",
"15" = "HI",
"16" = "ID",
"17" = "IL",
"18" = "IN",
"19" = "IA",
"20" = "KS",
"21" = "KY",
"22" = "LA",
"23" = "ME",
"24" = "MD",
"25" = "MA",
"26" = "MI",
"27" = "MN",
"28" = "MS",
"29" = "MO",
"30" = "MT",
"31" = "NE",
"32" = "NV",
"33" = "NH",
"34" = "NJ",
"35" = "NM",
"36" = "NY",
"37" = "NC",
"38" = "ND",
"39" = "OH",
"40" = "OK",
"41" = "OR",
"42" = "PA",
"44" = "RI",
"45" = "SC",
"46" = "SD",
"47" = "TN",
"48" = "TX",
"49" = "UT",
"50" = "VT",
"51" = "VA",
"53" = "WA",
"54" = "WV",
"55" = "WI",
"56" = "WY",
"60" = "AS",
"66" = "GU",
"69" = "MP",
"72" = "PR",
"78" = "VI",
  "99" = "Unknown",
  .default = "Unknown"))

#flourishing status

childhealthdata$flrish0to5_1920 = as.factor(childhealthdata$flrish0to5_1920) # converting to categorical

childhealthdata <- childhealthdata %>% mutate(FlourishStatus = recode(flrish0to5_1920, 
  "1" = "Always",
  "2" = "Usually",
  "3" = "Sometimes",
  "4" = "Never",
  "90" = "NA",
"95" =  "NA",
  "99" = "Unknown",
  .default = "Unknown"))

#forgoing care

childhealthdata$ForgoneCare_1920 = as.factor(childhealthdata$ForgoneCare_1920) # converting to categorical

childhealthdata <- childhealthdata %>% mutate(WentWithoutCare = recode(ForgoneCare_1920, 
  "1" = "Yes",
  "2" = "No",
  "99" = "Unknown",
  .default = "Unknown"))

childhealthdata <- childhealthdata %>% mutate(behavior_1920 = recode(behavior_1920, 
  "1" = "No",
  "2" = "Used to",
  "3" = "Yes",
  "99" = "Unknown",
  "96" = "NA Under 3",
  .default = "Unknown"))

childhealthdata <- transform(childhealthdata,
  NbhdSafe_1920 = factor(NbhdSafe_1920))

childhealthdata <- childhealthdata %>% mutate(NbhdSafe_1920 = recode(NbhdSafe_1920, 
  "1" = "Definitely Agree",
  "2" = "Somewhat Agree",
  "3" = "Somewhat/Definitely Disagree",
  "99" = "Unknown",
  .default = "Unknown"))

childhealthdata <- childhealthdata %>% mutate(povlev4_1920 = recode(povlev4_1920, 
  "1" = "0-99% FPL",
  "2" = "100% FPL or greater",
  "3" = "100% FPL or greater",
  "4" = "100% FPL or greater",
  .default = "Unknown"))


childhealthdata <- childhealthdata %>% mutate(EmSupport_1920 = recode(EmSupport_1920, 
  "1" = "Yes",
  "2" = "No",
  "99" = "Unknown",
  .default = "Unknown"))
```

```{r creating new variables}

#filters
FiveAndUnder <- childhealthdata %>%
  filter(Child.Age <= 5)

MissedNeededCare <- childhealthdata %>%
  filter(WentWithoutCare == "Yes")

parentEmoSup <- childhealthdata %>%
  filter(SomeoneEmoSup == 1)

yesbehaviorprobsunder5 <- FiveAndUnder %>%
  filter(behavior_1920 == "Yes")

yesbehaviorprobsALL <- childhealthdata %>%
  filter(behavior_1920 == "Yes")

#creating new variables 

flourishingunder5 <- FiveAndUnder %>% 
  group_by(FlourishStatus) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

flourishingAll <- childhealthdata %>% 
  group_by(FlourishStatus) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)


MissedCarebyState <- MissedNeededCare %>%
  group_by(State) %>%
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

MissedCarebyState

```

## Visualizing 
```{r flourishing visual histogram}
flourishplot <- ggplot(flourishing, aes(x = FlourishStatus, y = children, fill = children)) +
  geom_bar(stat = "identity") +
  scale_fill_viridis_b(name="Number of Children") +
  labs(title = "Frequency of 'Flourishing' Status in Children Under 5", x = "Frequency", y = "Number of Children")

flourishplot
```

```{r missed needed care}
missingcareplot <- ggplot(MissedCarebyState, aes(x = State, y = children, fill = children)) +
  geom_bar(stat = "identity") +
  scale_fill_viridis_b(name="Number of Children") + coord_flip() +
  labs(title = "Number of Children who Missed Needed Care", x = "State", y = "Number of Children")

missingcareplot
```

```{r forgone needed care}
forgonebysexplot <- ggplot(childhealthdata) +
  geom_bar(aes(x = WentWithoutCare, fill = Sex), position = "fill")

ggplot(childhealthdata) +
  geom_bar(aes(x = RaceCat, fill = FlourishStatus), position = "dodge")

ggplot(childhealthdata) +
  geom_bar(aes(x = RaceCat, fill = NbhdSafe_1920))
```

```{r behavioral problems}

behaviorprobs <- FiveAndUnder %>% 
  group_by(behavior_1920) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

#^not interesting, majority "no" or "unknown" 

ggplot(behaviorprobsALL, aes(x = behavior_1920, y = children, fill = children)) +
     geom_bar(stat = "identity") +
     scale_fill_viridis_b(name="Number of Children") +
     labs(title = "Children with Behavioral Problems Under 5", x = "Frequency", y = "Number of Children")

yesbehaviorprobsALL %>% 
  group_by(EmSupport_1920) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)


```

```{r variables by poverty}
ggplot(FiveAndUnder) +
  geom_bar(aes(x = povlev4_1920, fill = FlourishStatus), position = "dodge")

#missed care by FPL
carebypoverty <- MissedNeededCare %>% 
  group_by(povlev4_1920) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

ggplot(carebypoverty, aes(x = povlev4_1920, y = children, fill = children)) +
     geom_bar(stat = "identity") +
     scale_fill_viridis_b(name="Number of Children") +
     labs(title = "Children who did not receive needed care by poverty level", x = "Frequency", y = "Number of Children")

#behavior problem by FPL

BehavbyPov <- yesbehaviorprobsALL %>% 
  group_by(povlev4_1920) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

BehavbyPovALL <- yesbehaviorprobsALL %>% 
  group_by(povlev4_1920) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

ggplot(BehavbyPovALL, aes(x = povlev4_1920, y = children, fill = children)) +
     geom_bar(stat = "identity") +
     scale_fill_viridis_b(name="Number of Children") +
     labs(title = "Children with behavioral problems by poverty level", x = "Frequency", y = "Number of Children")

```

```{r all children}

#behavior 
behaviorprobsALL <- childhealthdata %>% 
  group_by(behavior_1920) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

yesbehaviorprobsALL %>% 
  group_by(povlev4_1920) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)


```

```{r health status}

FiveAndUnder %>% 
  group_by(ChildHealthStatus) %>% 
  count() %>% arrange(desc(n)) %>%
  rename("children" = n)

ggplot(FiveAndUnder) +
  geom_bar(aes(x = ChildHealthStatus, fill = EmSupport_1920))

ggplot(FiveAndUnder) +
  geom_bar(aes(x = ChildHealthStatus, fill = povlev4_1920))


```

```{r emo support}
ggplot(childhealthdata) +
  geom_bar(aes(x = ChildHealthStatus, fill = EmSupport_1920))

ggplot(childhealthdata) +
  geom_bar(aes(x = behavior_1920, fill = EmSupport_1920))


```

